#!/usr/bin/env python2.7

import socket
import json
#import androidhelper
from kivy.app import App
from kivy.uix.label import Label
from kivy.uix.floatlayout import FloatLayout
from kivy.properties import ObjectProperty, StringProperty

def linesplit(socket):
	buffer = socket.recv(4096)
	done = False
	while not done:
		more = socket.recv(4096)
		if not more:
			done = True
		else:
			buffer = buffer+more
	if buffer:
				return buffer

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(('iconia.setkeh.local',4028))
s.send(json.dumps({"command":"pga","parameter":"0"}))    
response = linesplit(s)
response = response.replace('\x00','')
response = json.loads(response)
def p0_mhs():
    return response['PGA'][0]['MHS av']
def p0_accepted(): 
    return response['PGA'][0]['Accepted'] 
def p0_rejected(): 
    return response['PGA'][0]['Rejected']
def p0_hwerrors():
    return response['PGA'][0]['Hardware Errors']
def p0_utility():
    return response['PGA'][0]['Utility']
s.close()

class cginfo(FloatLayout):
	label_wid = ObjectProperty()
	def mhs():
		return Label(text="PGA0 MHS: %s" % p0_mhs())
	
	def acc():
		return Label(text="PGA0 Accepted: %s" % p0_accepted())
	info = mhs()

class MyApp(App):

    def build(self):
	    return cginfo(info='Cgminer Stats')
	   # pass
#	    return Label(text="PGA0 Stats:")

if __name__ == '__main__':
    MyApp().run()
